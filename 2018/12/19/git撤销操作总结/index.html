<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>git撤销操作总结 | guidetheorient&#39;s blog</title>
    <meta name="description" content="guidetheorients blog">
    
    
    <link rel="preload" href="/assets/css/0.styles.4c902e38.css" as="style"><link rel="preload" href="/assets/js/app.61367982.js" as="script"><link rel="preload" href="/assets/js/9.fb7c7d93.js" as="script"><link rel="preload" href="/assets/js/1.d1e78a2f.js" as="script"><link rel="preload" href="/assets/js/13.b610d06e.js" as="script"><link rel="prefetch" href="/assets/js/10.ffc23745.js"><link rel="prefetch" href="/assets/js/11.0e3acbe3.js"><link rel="prefetch" href="/assets/js/12.1f976242.js"><link rel="prefetch" href="/assets/js/14.7f64767e.js"><link rel="prefetch" href="/assets/js/4.b3aa598f.js"><link rel="prefetch" href="/assets/js/5.e77566e4.js"><link rel="prefetch" href="/assets/js/6.8758a44c.js"><link rel="prefetch" href="/assets/js/7.51f78643.js"><link rel="prefetch" href="/assets/js/8.78c49fe1.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.72fbdecd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4c902e38.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container post-ct no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <div class="nav-ct"><a href="/" class="home-link router-link-active"><!----> <span class="site-name">
        guidetheorient's blog
      </span></a> <div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div><div class="nav-item"><a href="/tag/" class="nav-link">标签</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/links/" class="nav-link">友链</a></div></nav></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div><div class="nav-item"><a href="/tag/" class="nav-link">标签</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/links/" class="nav-link">友链</a></div></nav>  <!----> </aside> <div class="theme-default-content"><h1 id="git撤销操作总结"><a href="#git撤销操作总结" aria-hidden="true" class="header-anchor">#</a>
    git撤销操作总结
  </h1> <p id="post-info">
    发布于 Dec 19, 2018 /
    最后更新于 Sep 29, 2019 / 
    in category 技术
  </p> <div id="post-tags"><a href="/tag/git">git</a></div> <hr> <div class="post content__default"><div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>以下操作通常都不适用于已经push到远程的commit（除了revert）</p></div> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>进行危险操作时:<br>
1.最好确保工作区是clean的<br>
2.checkout到一个新分支进行操作</p></div> <p>工作中，git rebase出现冲突，合并冲突即可解决。但有时git rebase异常，出现删文件或者commit消失的情况，此时rebase已经成功，所以需要撤销这次rebase，于是在此记录。</p> <h2 id="撤销历史操作"><a href="#撤销历史操作" aria-hidden="true" class="header-anchor">#</a> 撤销历史操作</h2> <h3 id="git-reflog"><a href="#git-reflog" aria-hidden="true" class="header-anchor">#</a> git reflog</h3> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>这个方法针对的是个人操作，每个人的reflog都不一样，所以只能用来查最近的的还存在个人reflog中的提交。</p></div> <blockquote><p>当你在工作时，Git 会在后台保存一个引用日志(reflog)，引用日志记录了一些最近你的 HEAD 和分支引用所指向的历史。</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code>a005f07e <span class="token punctuation">(</span>HEAD -<span class="token operator">&gt;</span> origin-head<span class="token punctuation">)</span> HEAD@<span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span>: reset: moving to a005f07e
53ec2acc HEAD@<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span>: reset: moving to 53ec2acc
53ec2acc HEAD@<span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">}</span>: reset: moving to HEAD@<span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">}</span>
b8c44a72 <span class="token punctuation">(</span>mobile<span class="token punctuation">)</span> HEAD@<span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">}</span>: checkout: moving from mobile to origin-head
b8c44a72 <span class="token punctuation">(</span>mobile<span class="token punctuation">)</span> HEAD@<span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">}</span>: rebase finished: returning to refs/heads/mobile
b8c44a72 <span class="token punctuation">(</span>mobile<span class="token punctuation">)</span> HEAD@<span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">}</span>: rebase: *1248 fix<span class="token punctuation">(</span>mobile/alarm<span class="token punctuation">)</span> HACK - ios 微信6.7.4最新版内置浏览
器键盘弹出再收起 <span class="token number">1</span>.页面上滑不能恢复原样 <span class="token number">2</span>.点击区域错位
011bd620 <span class="token punctuation">(</span>origin/upgrade-dev<span class="token punctuation">)</span> HEAD@<span class="token punctuation">{</span><span class="token number">6</span><span class="token punctuation">}</span>: rebase: checkout remotes/origin/upgrade-dev
</code></pre></div><h3 id="git-reset"><a href="#git-reset" aria-hidden="true" class="header-anchor">#</a> git reset</h3> <p><a href="/pro-git/7.7 reset checkout.html#git-reset">见git reset</a></p> <h3 id="操作"><a href="#操作" aria-hidden="true" class="header-anchor">#</a> 操作</h3> <p>git的操作，如reset, merge, rebase, commit都会记录在reflog中，所以只要使用<code>git reflog</code>找出要恢复到的那次操作，如<code>HEAD@{10}</code>，然后使用<code>git reset --hard HEAD@{10}</code>即可恢复到那次操作。不论你前一次操作是<code>git reset --hard &lt;commit&gt;</code>或者是<code>git rebase master dev</code></p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>一般我们会在错误操作后立即恢复，所以此时HEAD@{1}为上一次操作记录，直接使用以下命令也可
<code>ORIG_HEAD</code>代表git记录的最近一次危险操作，所以包含的情况时reflog的子集，比如不包含commit
<code>git reset --hard HEAD@{1}</code>或者<code>git reset --hard ORIG_HEAD</code></p></div> <div class="language-bash extra-class"><pre class="language-bash"><code>// --soft将HEAD指针移至指定commit，指定commit之后的修改会放在暂存区中
<span class="token function">git</span> reset --soft <span class="token operator">&lt;</span>commit<span class="token operator">&gt;</span>
// 除了--soft之外，指定commit之后的修改会放在工作区中
<span class="token function">git</span> reset --mixied <span class="token operator">&lt;</span>commit<span class="token operator">&gt;</span>
// 除了--mixied之外，指定commit之后的修改会直接丢弃掉
<span class="token function">git</span> reset --hard <span class="token operator">&lt;</span>commit<span class="token operator">&gt;</span>
</code></pre></div><h2 id="修改上一次提交"><a href="#修改上一次提交" aria-hidden="true" class="header-anchor">#</a> 修改上一次提交</h2> <p><code>git commit --amend</code></p> <h2 id="修改多次提交"><a href="#修改多次提交" aria-hidden="true" class="header-anchor">#</a> 修改多次提交</h2> <p>交互式rebase的功能在操作多次未提交commit时非常有用，以某次<code>&lt;commit&gt;</code>为基础，重写其后(不包含这次)所有的commit，可以进行非常多的操作。我经常使用的有<code>squash</code>, <code>reword</code></p> <p><code>git rebase -i &lt;commit&gt;</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># p, pick &lt;commit&gt; = use commit 默认项(保留)</span>
<span class="token comment"># r, reword &lt;commit&gt; = use commit, but edit the commit message (修改commit信息)</span>
<span class="token comment"># e, edit &lt;commit&gt; = use commit, but stop for amending (修改此次提交)</span>
<span class="token comment"># s, squash &lt;commit&gt; = use commit, but meld into previous commit (合并至前一次提交)</span>
<span class="token comment"># f, fixup &lt;commit&gt; = like &quot;squash&quot;, but discard this commit's log message</span>
<span class="token comment"># x, exec &lt;command&gt; = run command (the rest of the line) using shell</span>
<span class="token comment"># b, break = stop here (continue rebase later with 'git rebase --continue')</span>
<span class="token comment"># d, drop &lt;commit&gt; = remove commit</span>
<span class="token comment"># l, label &lt;label&gt; = label current HEAD with a name</span>
<span class="token comment"># t, reset &lt;label&gt; = reset HEAD to a label</span>
<span class="token comment"># m, merge [-C &lt;commit&gt; | -c &lt;commit&gt;] &lt;label&gt; [# &lt;oneline&gt;]</span>
<span class="token comment"># .       create a merge commit using the original merge commit's</span>
<span class="token comment"># .       message (or the oneline, if no original merge commit was</span>
<span class="token comment"># .       specified). Use -c &lt;commit&gt; to reword the commit message.</span>
</code></pre></div><h2 id="其他"><a href="#其他" aria-hidden="true" class="header-anchor">#</a> 其他</h2> <ul><li><p>撤销文件改动<br> <code>git checkout -- &lt;file&gt;...</code></p></li> <li><p>撤销暂存文件改动<br> <code>git reset HEAD &lt;file&gt;...</code></p></li> <li><p>撤销上一次提交<br>
比如提交已经提交到远程，不适合再使用reset来移动HEAD，此时可以使用revert，用一次新的commit来回滚之前的commit<br> <code>git revert &lt;commit&gt;</code></p></li> <li><p>只add，没有commit后执行了危险操作<br> <a href="https://www.cnblogs.com/hope-markup/p/6683522.html" target="_blank" rel="noopener noreferrer">关于git reset --hard这个命令的惨痛教训<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul> <blockquote><p>参考<br> <a href="https://www.centos.bz/2018/01/%E4%BB%8E%E6%92%A4%E9%94%80-rebase-%E8%B0%88%E8%B0%88-git-%E5%8E%9F%E7%90%86/#%E5%88%A9%E7%94%A8%20reflog%20%E6%92%A4%E9%94%80%E5%8F%98%E5%9F%BA" target="_blank" rel="noopener noreferrer">1. 从撤销 rebase 谈谈 git 原理<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://blog.csdn.net/sndamhming/article/details/53993502" target="_blank" rel="noopener noreferrer">2. Git中HEAD和ORIG_HEAD指针指的是什么<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://git-scm.com/book/zh/v2" target="_blank" rel="noopener noreferrer">3. Pro Git<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote></div> <hr></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.61367982.js" defer></script><script src="/assets/js/9.fb7c7d93.js" defer></script><script src="/assets/js/1.d1e78a2f.js" defer></script><script src="/assets/js/13.b610d06e.js" defer></script>
  </body>
</html>
